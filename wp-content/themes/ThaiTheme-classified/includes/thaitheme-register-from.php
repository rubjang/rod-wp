<div class="tt_fb_login"><div class="tt_fb_from"><span class="tt_h">เข้าระบบด้วย Facebook </span><div class="tt_fb_btn"><?php do_action('facebook_login_button'); ?></div>**คุณสามารถเข้าสู่ระบบด้วย Facebook ได้เลยทันที โดยไม่ต้องสมัครสมาชิก</div></div><div class="tt_login"><div class="tt-form"><div class="tt_login_form"><span class="tt_h">สมัครสมาชิกใหม่</span><?php $err = ''; $success = '';    global $wpdb, $PasswordHash, $current_user, $user_ID;    if(isset($_POST['task']) && $_POST['task'] == 'register' ) {        $pwd1 = $wpdb->escape(trim($_POST['pwd1']));        $pwd2 = $wpdb->escape(trim($_POST['pwd2']));        $first_name = $wpdb->escape(trim($_POST['first_name']));        $last_name = $wpdb->escape(trim($_POST['last_name']));        $email = $wpdb->escape(trim($_POST['email']));        $username = $wpdb->escape(trim($_POST['username']));        /*if( $email == "" || $pwd1 == "" || $pwd2 == "" || $username == "" || $first_name == "" || $last_name == "") { OLD by OH*/        if( $pwd1 == "" || $pwd2 == "" || $username == "" || $first_name == "" || $last_name == "") {            $err = 'กรุณาใส่ข้อมูล';        } else if(!filter_var($email, FILTER_VALIDATE_EMAIL)) {            $err = 'รูปแบบอีเมลล์ไม่ถูกต้อง';        } else if(email_exists($email) ) {            $err = 'มีผู้ใช้อีเมลนี้แล้ว';        } else if($pwd1 <> $pwd2 ){            $err = 'รหัสผ่านไม่ตรงกัน';        } else {            $user_id = wp_insert_user( array ('first_name' => apply_filters('pre_user_first_name', $first_name), 'last_name' => apply_filters('pre_user_last_name', $last_name), 'user_pass' => apply_filters('pre_user_user_pass', $pwd1), 'user_login' => apply_filters('pre_user_user_login', $username), 'user_email' => apply_filters('pre_user_user_email', $email), 'role' => 'subscriber' ) );            if( is_wp_error($user_id) ) {                $err = 'ไม่สามารถสมัครสมาชิกได้';            } else {                do_action('user_register', $user_id);                $success = 'สมัครสมาชิกสำเร็จ.. สามารถใช้ อีเมลและรหัสผ่านเข้าสู่ระบบได้เลย';            }        }    }    ?><p class="status_cap"></p><?php if(! empty($err) ) { ?> <p class="status red"><?php echo ''.$err.''; ?></p><?php } else {?><?php } ?><?php if(! empty($success) ) { ?> <p class="status green"><?php echo ''.$success.''; ?></p><?php } else {?><?php } ?><p class="error"></p>    <form id="thaitheme_from_register" name="thaitheme_form_captcha" method="post">        <p><input type="text" value="" name="username" id="username" placeholder="ใส่ชื่อสำหรับ เข้าสู่ระบบ" maxlength="16"/></p>        <p><input type="text" value="" name="email" id="email" placeholder="ใส่อีเมล์" /></p>        <p><input type="text" value="" name="first_name" id="first_name" placeholder="ใส่ชื่อจริง" /></p>        <p><input type="text" value="" name="last_name" id="last_name" placeholder="ใส่นามสกุลจริง" /></p>        <p><input type="password" value="" name="pwd1" id="pwd1" placeholder="ใส่รหัสผ่าน" /></p>        <p><input type="password" value="" name="pwd2" id="pwd2" placeholder="ยืนยันรหัสผ่านอีกครั้ง" /></p>		<img src="<?php bloginfo('template_url'); ?>/includes/thaitheme-core/thaitheme-captcha/captcha.php" class="form_captcha" />		<input type="text" name="captcha" value="" class="captcha" placeholder="ใส่รหัสภาพ" />		<div class="tt_bt_form">        <button type="submit" name="btnregister" class="submit_button" >สมัครสมาชิก</button>		<a class="tt_register_btn" href="<?php echo home_url( '/' ); ?>?p=<?php global $thaitheme_option; echo $thaitheme_option['thaitheme_select_login'];  ?>">เข้าสู่ระบบ</a>		</div>        <input type="hidden" name="task" value="register" />    </form></div></div></div>